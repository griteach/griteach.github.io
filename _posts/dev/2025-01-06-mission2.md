---
title: tanstack query 적용
date: 2025-01-06 22:38:00 +0900
categories: [Development]
tags: [dev, school-display, mission, tanstack]     # TAG names should always be lowercase
---

# 맨날 터지는 날씨 api 캐싱으로 해결해보자.

data.go.kr 날씨 api 호출은 상당히 번거롭다(~~내기준~~). 일단 단기예보, 중기예보, 육상날씨 등 endpoint도 다 다르고 심지어 데이터 갱신 시간과 조회 가능시간도 모두 다 다르다. 게다가... 이게 자꾸 바뀌기도 한다 ㅋㅋㅋ

> 1. 데이터 갱신 시각과 겹치면 조회했을 때 에러 발생
> 2. 갱신 시각과 겹칠 때는 조회하지 않는 방법이 있겠지만, 이렇게 하면 당연히 날씨가 제대로 안나온다.
> 3. 데이터가 없을 때는 캐싱된 데이터를 그대로 보여준다.
> 4. 데이터가 없는 첫 조회에 오류가 나면 10분 후 다시 조회한다고 출력한다.

## endpoint 별 조회 가능 시각

> 서비스 URL : http://apis.data.go.kr/1360000/VilageFcstInfoService_2.0

### 단기예보

> endpoint : /getVilageFcst

- Base_time : 0200, 0500, 0800, 1100, 1400, 1700, 2000, 2300 (1일 8회)
- API 제공 시간(~이후) : 02:10, 05:10, 08:10, 11:10, 14:10, 17:10, 20:10, 23:10
- 예보기간(02, 05, 08, 11, 14시) : 1~3일 후는 1시간 간격, 4일 후는 3시간 간격, 5일 후는 X
- 예보기간(17, 20, 23시) : 1~4일 후 1시간 간격, 5일 후는 3시간 간격
~~대충 봐도 더럽게 생겼다..~~

> 결론 : 매 시각 10분 이후에 조회해야 한다. 10분 이후에 조회했을 때 새로운 데이터가 없다면 지난 시간의 데이터를 그대로 보여준다.

### 초단기실황

> endpoint : /getUltraSrtNcst

- base_time : 0000, 0100, 0200 ~ 2300 (1일 24회)
- 데이터 생성 시각 : 매시 정각
- API 제공 시간(~이후) : 00:10, 01:10, 02:10 ... 23:10 (매 시 10분)
- 예보기간 : 1시간 간격

> 결론 : 데이터 생성 시각과 제공 시각 사이에 조회하면 에러가 난다. (가장 대표적으로 많이 발생하는 상황) 따라서 이 경우에는 기존 데이터를 그대로 보여줘야 한다.

### 초단기예보

> endpoint : /getUltraSrtFcst

- base_time : 0030, 0130, 0230 ... 2330 (1일 24회)
- API 제공 시간(~이후) : 0045, 0145, 0245 ... 2345 (매 시 45분)
- 예보기간 : 매 발표시각마다 6시간 예보





